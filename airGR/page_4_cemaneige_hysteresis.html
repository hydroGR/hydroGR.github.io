<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Guillaume Thirel, Olivier Delaigue" />


<title>Using satellite snow cover area data for calibrating and improving CemaNeige</title>

<script src="site_libs/header-attrs-2.30/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<!-- NOTE: add "navbar-inverse" class for an alternate navbar background -->
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="index.html">airGR</a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
				<li><a href="index.html">Home</a></li>
     				<li><a href="page_1_get_started.html">Get Started</a></li>
				<li class="Download">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Articles<span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li><a href="page_2.1_param_optim.html">Plugging in new calibration algorithms in airGR</a></li>
						<li><a href="page_2.2_param_mcmc.html">Parameter estimation within a Bayesian MCMC framework</a></li>
						<li><a href="page_3_param_sets_GR4J.html">Generalist parameter sets for the GR4J model</a></li>
						<li><a href="page_4_cemaneige_hysteresis.html">Using satellite snow cover area data for calibrating and improving CemaNeige</a></li>
						<li><a href="page_5_sd_model.html">Simulated vs observed upstream flows in calibration of semi-distributed GR4J model</a></li>
					</ul>
				</li>
				<li class="Download">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Download<span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li><a tabindex="-1" href="https://CRAN.R-project.org/package=airGR" onclick="window.open(this.href); return false;">Package</a></li>
						<li><a tabindex="-1" href="https://CRAN.R-project.org/package=airGR/airGR.pdf" onclick="window.open(this.href); return false;">Manual</a></li>
					</ul>
				</li>
				<li><a href="NEWS.html">News</a></li>
				<li><a href="page_publications.html">Publications</a></li>
				<li><a href="page_faq.html">FAQ</a></li>
				<li class="Download">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">airGR Galaxy<span class="caret"></span></a>
					<ul class="dropdown-menu">
					  <li><a href="page_airGRgalaxy.html">Overview</a></li>
						<li><a href="https://CRAN.R-project.org/package=airGRdatasets">airGRdatasets R-package</a></li>
						<li><a href="https://CRAN.R-project.org/package=airGRdatassim">airGRdatassim R-package</a></li>
						<li><a href="https://airgriwrm.g-eau.fr/">airGRiwrm R-package</a></li>
						<li><a href="https://sunshine.inrae.fr/app/airGRmaps">airGRmaps web app</a></li>
						<li><a href="https://hydroGR.github.io/airGRteaching/">airGRteaching R-package</a></li>
						<li><a href="https://sunshine.inrae.fr/app/airGRteaching">airGRteaching web app</a></li>
					</ul>
				</li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<a href='https://www.inrae.fr/en/' onclick="window.open(this.href); return false;", title="inrae.fr"><img src='fig/logo_inrae_CMJN_square.svg' style='width:45px;height:45px;'></a>
				<a href='https://webgr.inrae.fr/eng/' onclick="window.open(this.href); return false;", title="webgr.inrae.fr"><img src='fig/logo_inrae_hydro_CMJN_square.svg' style='width:45px;height:45px;'></a>
				<a href='https://webgr.inrae.fr/eng/tools/software/airgr' onclick="window.open(this.href); return false;", title="aiGR"><img src='fig/logo_airGR_CMJN_square.svg' style='width:45px;height:45px;'></a>
				<a href='https://gitlab.irstea.fr/HYCAR-Hydro/airgr/' onclick="window.open(this.href); return false;", title="GitLab"><img src='fig/logo_gitlab_CMJN_square.svg' style='width:45px;height:45px;'></a>				
			</ul>
		</div><!--/.nav-collapse -->
	</div><!--/.container -->
</div><!--/.navbar -->
<p style ="margin-top: 15px;">
<a href="https://CRAN.R-project.org/package=airGR"><img src="https://www.r-pkg.org/badges/version-ago/airGR" /></a>
<a href="https://www.rdocumentation.org/packages/airGR"><img src="http://cranlogs.r-pkg.org/badges/grand-total/airGR?color=orange" /></a>
<a href="https://www.r-project.org/Licenses/GPL-2">
<svg xmlns="http://www.w3.org/2000/svg" width="095" height="020">
  <linearGradient id="b" x2="0" y2="100%">
    <stop offset="0" stop-opacity=".1" stop-color="#bbb"/>
    <stop offset="1" stop-opacity=".1"/>
  </linearGradient>
  <mask id="a">
    <rect width="095" height="020" rx="3" fill="#fff" />
  </mask>
  <g mask="url(#a)">
    <path fill="#555"    d="M00 0h055v20H00z"/>
    <path fill="#00a3a6" d="M55 0h040v20H55z"/>
    <path fill="url(#b)" d="M00 0h095v20H00z"/>
  </g>
  <g fill="#fff" text-anchor="middle"
     font-family="DejaVu Sans,Verdana,Geneva,sans-serif" font-size="11">
    <text x="028" y="015" fill="#010101" fill-opacity=".3">
      License
    </text>
    <text x="028" y="014">
      License
    </text>
    <text x="075" y="015" fill="#010101" fill-opacity=".3">
      GPL 2
    </text>
    <text x="075" y="014">
      GPL 2
    </text>
  </g>
</svg>
</a>
<a href="https://doi.org/10.1016/j.envsoft.2017.05.002"><img src="https://img.shields.io/badge/doi-10.1016/j.envsoft.2017.05.002-purple.svg" /></a>
<a href="https://doi.org/10.32614/CRAN.package.airGR">              <img src="https://img.shields.io/badge/doi-10.32614/CRAN.package.airGR-purple.svg" /></a>
</p>


<div id="header">



<h1 class="title toc-ignore">Using satellite snow cover area data for
calibrating and improving CemaNeige</h1>
<h4 class="author">Guillaume Thirel, Olivier Delaigue</h4>

</div>


<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<div id="scope" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Scope</h2>
<p>Rainfall-runoff models that include a snow accumulation and melt
module are still often calibrated using only discharge observations.
This can result in poor snow modeling as the swnow module parameters can
distorted in order to allow skilful discharge simulation.</p>
<p>After the work of <span class="citation">Riboust et al.
(2019)</span>, we propose now in
<strong><font color="#00a3a6">airGR</font></strong> an improved version
of the degree-day CemaNeige snow and accumulation module. This new
version is based on a more accurate representation of the relationship
that exists at the basin scale between the Snow Water Equivalent (SWE)
and the Snow Cover Area (SCA). To do so, a linear SWE-SCA hysteresis,
which represents the fact that snow accumulation is rather homogeneous
on the basin and snow melt is more heterogeneous, was implemented.</p>
<p>This new CemaNeige version has two more parameters to calibrate. It
also presents the advantage of allowing using satellite snow data to
constrain the calibration in addition to discharge. <span
class="citation">Riboust et al. (2019)</span> show that while the
simulated discharge is not significantly improved, the snow simulation
is much improved. In addition, they show that the model is more robust
(i.e. transferable in time) in terms of discharge, which has many
implications for climate change impact studies.</p>
<p>The configuration that was identified as optimal by <span
class="citation">Riboust et al. (2019)</span> includes a CemaNeige
module run on 5 elevation bands and an objective function determine by a
composite function of KGE’ calculated on discharge (75 % weight) and
KGE’ calculated on each elevation band (5 % for each).</p>
<p>In this article, we show how to use and calibrate this new CemaNeige
version.</p>
</div>
<div id="data-preparation" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Data preparation</h2>
<p>We load an example data set from the package. Please note that this
data set includes MODIS data that was pre-calculated for 5 elevation
bands and for which days with few data (more than 40 % cloud coverage)
were assigned as missing values.</p>
</div>
<div id="loading-catchment-data" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> loading catchment
data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">data</span>(X0310010)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">summary</span>(BasinObs)</span></code></pre></div>
</div>
<div id="object-model-preparation" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Object model
preparation</h2>
<p>We assume that the R global environment contains data and functions
from the <a
href="https://hydrogr.github.io/airGR/page_1_get_started.html">Get
Started</a> article.</p>
<p>The calibration period has been defined from 2000-09-01 to
2005-08-31, and the validation period from 2005-09-01 to 2010-07-31.
CemaNeige will be used in coupling with GR4J in this article.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="do">## preparation of the InputsModel object</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>InputsModel <span class="ot">&lt;-</span> <span class="fu">CreateInputsModel</span>(<span class="at">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>                                 <span class="at">DatesR =</span> BasinObs<span class="sc">$</span>DatesR, <span class="at">Precip =</span> BasinObs<span class="sc">$</span>P,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>                                 <span class="at">PotEvap =</span> BasinObs<span class="sc">$</span>E, <span class="at">TempMean =</span> BasinObs<span class="sc">$</span>T,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>                                 <span class="at">ZInputs =</span> <span class="fu">median</span>(BasinInfo<span class="sc">$</span>HypsoData),</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>                                 <span class="at">HypsoData =</span> BasinInfo<span class="sc">$</span>HypsoData, <span class="at">NLayers =</span> <span class="dv">5</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="do">## ---- calibration step</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="do">## calibration period selection</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>Ind_Cal <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">which</span>(<span class="fu">format</span>(BasinObs<span class="sc">$</span>DatesR, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="sc">==</span> <span class="st">&quot;2000-09-01&quot;</span>), </span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>               <span class="fu">which</span>(<span class="fu">format</span>(BasinObs<span class="sc">$</span>DatesR, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="sc">==</span> <span class="st">&quot;2005-08-31&quot;</span>))</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="do">## ---- validation step</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="do">## validation period selection</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>Ind_Val <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">which</span>(<span class="fu">format</span>(BasinObs<span class="sc">$</span>DatesR, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="sc">==</span> <span class="st">&quot;2005-09-01&quot;</span>), </span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>               <span class="fu">which</span>(<span class="fu">format</span>(BasinObs<span class="sc">$</span>DatesR, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="sc">==</span> <span class="st">&quot;2010-07-31&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="calibration-and-evaluation-of-the-new-cemaneige-module"
class="section level1" number="2">
<h1><span class="header-section-number">2</span> Calibration and
evaluation of the new CemaNeige module</h1>
<p>In order to use the Linear Hysteresis, a new argument
(<code>IsHyst</code>) is added in the <code>CreateRunOptions()</code>
and <code>CreateCalibOptions()</code> functions and has to be set to
<code>TRUE</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="do">## annual mean of average solid precipitation for each layer</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>SolidPrecip <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">sapply</span>(<span class="fu">seq_along</span>(InputsModel<span class="sc">$</span>LayerFracSolidPrecip), <span class="at">FUN =</span> <span class="cf">function</span>(iLayer) {</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">Cal =</span> <span class="fu">mean</span>(InputsModel<span class="sc">$</span>LayerFracSolidPrecip[[iLayer]][Ind_Cal] <span class="sc">*</span> </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                 InputsModel<span class="sc">$</span>LayerPrecip[[iLayer]][Ind_Cal]),</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="at">Val =</span> <span class="fu">mean</span>(InputsModel<span class="sc">$</span>LayerFracSolidPrecip[[iLayer]][Ind_Val] <span class="sc">*</span> </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>                 InputsModel<span class="sc">$</span>LayerPrecip[[iLayer]][Ind_Val]))</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>})))</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>Freqs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">hourly =</span> <span class="fl">365.25</span><span class="sc">*</span><span class="dv">24</span>, <span class="at">daily =</span> <span class="fl">365.25</span>, <span class="at">monthly =</span> <span class="dv">12</span>, <span class="at">yearly =</span> <span class="dv">1</span>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">class</span>(InputsModel), <span class="fu">names</span>(Freqs))</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>SolidPrecip<span class="sc">$</span>Cal <span class="ot">&lt;-</span> SolidPrecip<span class="sc">$</span>Cal <span class="sc">*</span> Freqs[Freq]</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>SolidPrecip<span class="sc">$</span>Val <span class="ot">&lt;-</span> SolidPrecip<span class="sc">$</span>Val <span class="sc">*</span> Freqs[Freq]</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="do">## calculation of solid precipitation by altitude zone, for calibration and validation periods</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>SolidPrecip <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(InputsModel<span class="sc">$</span>LayerFracSolidPrecip), <span class="at">FUN =</span> <span class="cf">function</span>(iLayer) {</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  Cal <span class="ot">&lt;-</span> <span class="fu">mean</span>(InputsModel<span class="sc">$</span>LayerFracSolidPrecip[[iLayer]][Ind_Cal] <span class="sc">*</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>                InputsModel<span class="sc">$</span>LayerPrecip[[iLayer]][Ind_Cal], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  Val <span class="ot">&lt;-</span> <span class="fu">mean</span>(InputsModel<span class="sc">$</span>LayerFracSolidPrecip[[iLayer]][Ind_Val] <span class="sc">*</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>                InputsModel<span class="sc">$</span>LayerPrecip[[iLayer]][Ind_Val], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">Cal =</span> Cal, <span class="at">Val =</span> Val)</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>})</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>SolidPrecip <span class="ot">&lt;-</span> <span class="fu">Map</span>(<span class="cf">function</span>(frac, precip) {</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">Cal =</span> <span class="fu">mean</span>(frac[Ind_Cal] <span class="sc">*</span> precip[Ind_Cal], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>    <span class="at">Val =</span> <span class="fu">mean</span>(frac[Ind_Val] <span class="sc">*</span> precip[Ind_Val], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>  },</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>  InputsModel<span class="sc">$</span>LayerFracSolidPrecip,</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>  InputsModel<span class="sc">$</span>LayerPrecip)</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>SolidPrecip <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, SolidPrecip))</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>Freqs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">hourly =</span> <span class="fl">365.25</span> <span class="sc">*</span> <span class="dv">24</span>, <span class="at">daily =</span> <span class="fl">365.25</span>, <span class="at">monthly =</span> <span class="dv">12</span>, <span class="at">yearly =</span> <span class="dv">1</span>)</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">class</span>(InputsModel), <span class="fu">names</span>(Freqs))</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>SolidPrecip <span class="ot">&lt;-</span> SolidPrecip <span class="sc">*</span> Freqs[Freq]</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="do">## preparation of the RunOptions object for the calibration period</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>RunOptions_Cal <span class="ot">&lt;-</span> <span class="fu">CreateRunOptions</span>(<span class="at">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>                                   <span class="at">InputsModel =</span> InputsModel, <span class="at">IndPeriod_Run =</span> Ind_Cal,</span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>                                   <span class="at">IsHyst =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>                                   <span class="at">MeanAnSolidPrecip =</span> SolidPrecip<span class="sc">$</span>Cal)</span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="do">## preparation of the RunOptions object for the validation period</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>RunOptions_Val <span class="ot">&lt;-</span> <span class="fu">CreateRunOptions</span>(<span class="at">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>                                   <span class="at">InputsModel =</span> InputsModel, <span class="at">IndPeriod_Run =</span> Ind_Val,</span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>                                   <span class="at">IsHyst =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>                                   <span class="at">MeanAnSolidPrecip =</span> SolidPrecip<span class="sc">$</span>Val)</span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="do">## preparation of the CalibOptions object</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>CalibOptions <span class="ot">&lt;-</span> <span class="fu">CreateCalibOptions</span>(<span class="at">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>                                   <span class="at">FUN_CALIB =</span> Calibration_Michel,</span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a>                                   <span class="at">IsHyst =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>In order to calibrate and assess the model performance, we will
follow the recommendations of <span class="citation">Riboust et al.
(2019)</span>. This is now possible in
<strong><font color="#00a3a6">airGR</font></strong> with the added
functionality that permits calculating composite criteria by combining
different metrics.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">## efficiency criterion: 75 % KGE&#39;(Q) + 5 % KGE&#39;(SCA) on each of the 5 layers</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>InputsCrit_Cal  <span class="ot">&lt;-</span> <span class="fu">CreateInputsCrit</span>(<span class="at">FUN_CRIT =</span> <span class="fu">rep</span>(<span class="st">&quot;ErrorCrit_KGE2&quot;</span>, <span class="dv">6</span>),</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                                    <span class="at">InputsModel =</span> InputsModel, <span class="at">RunOptions =</span> RunOptions_Cal,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>                                    <span class="at">Obs =</span> <span class="fu">list</span>(BasinObs<span class="sc">$</span>Qmm[Ind_Cal],</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA1[Ind_Cal],</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA2[Ind_Cal],</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA3[Ind_Cal],</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA4[Ind_Cal],</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA5[Ind_Cal]),</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>                                    <span class="at">VarObs =</span> <span class="fu">list</span>(<span class="st">&quot;Q&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>),</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>                                    <span class="at">Weights =</span> <span class="fu">list</span>(<span class="fl">0.75</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>))</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>InputsCrit_Val  <span class="ot">&lt;-</span> <span class="fu">CreateInputsCrit</span>(<span class="at">FUN_CRIT =</span> <span class="fu">rep</span>(<span class="st">&quot;ErrorCrit_KGE2&quot;</span>, <span class="dv">6</span>),</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>                                    <span class="at">InputsModel =</span> InputsModel, <span class="at">RunOptions =</span> RunOptions_Val,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>                                    <span class="at">Obs =</span> <span class="fu">list</span>(BasinObs<span class="sc">$</span>Qmm[Ind_Val],</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA1[Ind_Val],</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA2[Ind_Val],</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA3[Ind_Val],</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA4[Ind_Val],</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>                                               BasinObs<span class="sc">$</span>SCA5[Ind_Val]),</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>                                    <span class="at">VarObs =</span> <span class="fu">list</span>(<span class="st">&quot;Q&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>),</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>                                    <span class="at">Weights =</span> <span class="fu">list</span>(<span class="fl">0.75</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>))</span></code></pre></div>
<p>We can now calibrate the model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="do">## calibration</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>OutputsCalib <span class="ot">&lt;-</span> <span class="fu">Calibration</span>(<span class="at">InputsModel =</span> InputsModel, <span class="at">RunOptions =</span> RunOptions_Cal,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>                            <span class="at">InputsCrit =</span> InputsCrit_Cal, <span class="at">CalibOptions =</span> CalibOptions,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>                            <span class="at">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>                            <span class="at">FUN_CALIB =</span> Calibration_Michel)</span></code></pre></div>
<p>Now we can run it on the calibration period and assess it.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## run on the calibration period</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>OutputsModel_Cal <span class="ot">&lt;-</span> <span class="fu">RunModel_CemaNeigeGR4J</span>(<span class="at">InputsModel =</span> InputsModel,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                                           <span class="at">RunOptions =</span> RunOptions_Cal, </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                                           <span class="at">Param =</span> OutputsCalib<span class="sc">$</span>ParamFinalR)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="do">## evaluation </span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>OutputsCrit_Cal <span class="ot">&lt;-</span> <span class="fu">ErrorCrit</span>(<span class="at">InputsCrit =</span> InputsCrit_Cal, <span class="at">OutputsModel =</span> OutputsModel_Cal)</span></code></pre></div>
<p>Find below the performance of the model over the calibration
period.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">str</span>(OutputsCrit_Cal, <span class="at">max.level =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## List of 7
##  $ CritValue      : num 0.899
##  $ CritName       : chr &quot;Composite&quot;
##  $ CritBestValue  : num 1
##  $ Multiplier     : num -1
##  $ Ind_notcomputed: NULL
##  $ CritCompo      :List of 3
##   ..$ MultiCritValues : Named num [1:6] 0.919 0.705 0.847 0.88 0.874 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritNames  : Named chr [1:6] &quot;KGE2[Q]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritWeights: Named num [1:6] 0.75 0.05 0.05 0.05 0.05 0.05
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##  $ MultiCrit      :List of 6
##   ..$ IC1:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC2:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC3:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC4:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC5:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC6:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;Compo&quot; &quot;ErrorCrit&quot;</code></pre>
<p>Now we can run the model on the validation period and assess it.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="do">## run on the validation period</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>OutputsModel_Val <span class="ot">&lt;-</span> <span class="fu">RunModel_CemaNeigeGR4J</span>(<span class="at">InputsModel =</span> InputsModel,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                                           <span class="at">RunOptions =</span> RunOptions_Val, </span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                                           <span class="at">Param =</span> OutputsCalib<span class="sc">$</span>ParamFinalR)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="do">## evaluation </span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>OutputsCrit_Val <span class="ot">&lt;-</span> <span class="fu">ErrorCrit</span>(<span class="at">InputsCrit =</span> InputsCrit_Val, <span class="at">OutputsModel =</span> OutputsModel_Val)</span></code></pre></div>
<p>Find below the performance of the model over the validation
period.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">str</span>(OutputsCrit_Val, <span class="at">max.level =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## List of 7
##  $ CritValue      : num 0.903
##  $ CritName       : chr &quot;Composite&quot;
##  $ CritBestValue  : num 1
##  $ Multiplier     : num -1
##  $ Ind_notcomputed: NULL
##  $ CritCompo      :List of 3
##   ..$ MultiCritValues : Named num [1:6] 0.916 0.63 0.876 0.945 0.962 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritNames  : Named chr [1:6] &quot;KGE2[Q]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritWeights: Named num [1:6] 0.75 0.05 0.05 0.05 0.05 0.05
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##  $ MultiCrit      :List of 6
##   ..$ IC1:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC2:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC3:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC4:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC5:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC6:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;Compo&quot; &quot;ErrorCrit&quot;</code></pre>
</div>
<div
id="comparison-with-the-performance-of-the-initial-cemaneige-version"
class="section level1" number="3">
<h1><span class="header-section-number">3</span> Comparison with the
performance of the initial CemaNeige version</h1>
<p>Here we use the same InputsModel object and calibration and
validation periods. However, we have to redefine the way we run the
model (<code>RunOptions</code> argument), calibrate and assess it
(<code>InputsCrit</code> argument). The objective function is only based
on KGE’(Q). Note how we set the <code>IsHyst</code> argument to
<code>FALSE</code> in the <code>CreateRunOptions()</code> and the
<code>CreateCalibOptions()</code> functions.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="do">## preparation of RunOptions object</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>RunOptions_Cal_NoHyst <span class="ot">&lt;-</span> <span class="fu">CreateRunOptions</span>(<span class="at">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>                                          <span class="at">InputsModel =</span> InputsModel,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>                                          <span class="at">IndPeriod_Run =</span> Ind_Cal,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>                                          <span class="at">IsHyst =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>RunOptions_Val_NoHyst <span class="ot">&lt;-</span> <span class="fu">CreateRunOptions</span>(<span class="at">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>                                          <span class="at">InputsModel =</span> InputsModel, </span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>                                          <span class="at">IndPeriod_Run =</span> Ind_Val,</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>                                          <span class="at">IsHyst =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>InputsCrit_Cal_NoHyst <span class="ot">&lt;-</span> <span class="fu">CreateInputsCrit</span>(<span class="at">FUN_CRIT =</span> ErrorCrit_KGE2,</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>                                          <span class="at">InputsModel =</span> InputsModel,</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>                                          <span class="at">RunOptions =</span> RunOptions_Cal_NoHyst,</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>                                          <span class="at">Obs =</span> BasinObs<span class="sc">$</span>Qmm[Ind_Cal], <span class="at">VarObs =</span> <span class="st">&quot;Q&quot;</span>)</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="do">## preparation of CalibOptions object</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>CalibOptions_NoHyst <span class="ot">&lt;-</span> <span class="fu">CreateCalibOptions</span>(<span class="at">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>                                          <span class="at">FUN_CALIB =</span> Calibration_Michel,</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>                                          <span class="at">IsHyst =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We can now calibrate the model.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="do">## calibration</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>OutputsCalib_NoHyst <span class="ot">&lt;-</span> <span class="fu">Calibration</span>(<span class="at">InputsModel =</span> InputsModel,</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>                                   <span class="at">InputsCrit =</span> InputsCrit_Cal_NoHyst,</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>                                   <span class="at">RunOptions =</span> RunOptions_Cal_NoHyst,</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>                                   <span class="at">CalibOptions =</span> CalibOptions_NoHyst,</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>                                   <span class="at">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>                                   <span class="at">FUN_CALIB =</span> Calibration_Michel)</span></code></pre></div>
<p>And run it over the calibration and validation periods.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>OutputsModel_Cal_NoHyst <span class="ot">&lt;-</span> <span class="fu">RunModel_CemaNeigeGR4J</span>(<span class="at">InputsModel =</span> InputsModel,</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>                                                  <span class="at">RunOptions =</span> RunOptions_Cal_NoHyst,  </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>                                                  <span class="at">Param =</span> OutputsCalib_NoHyst<span class="sc">$</span>ParamFinalR)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>OutputsModel_Val_NoHyst <span class="ot">&lt;-</span> <span class="fu">RunModel_CemaNeigeGR4J</span>(<span class="at">InputsModel =</span> InputsModel,</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>                                                  <span class="at">RunOptions =</span> RunOptions_Val_NoHyst, </span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>                                                  <span class="at">Param =</span> OutputsCalib_NoHyst<span class="sc">$</span>ParamFinalR)</span></code></pre></div>
<p>In order to assess the model performance over the two periods, we
will use the InputsCrit objects prepared before, which allow assessing
also the performance in terms of snow simulation.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>OutputsCrit_Cal_NoHyst <span class="ot">&lt;-</span> <span class="fu">ErrorCrit</span>(<span class="at">InputsCrit =</span> InputsCrit_Cal,</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>                                    <span class="at">OutputsModel =</span> OutputsModel_Cal_NoHyst)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>OutputsCrit_Val_NoHyst <span class="ot">&lt;-</span> <span class="fu">ErrorCrit</span>(<span class="at">InputsCrit =</span> InputsCrit_Val,</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>                                    <span class="at">OutputsModel =</span> OutputsModel_Val_NoHyst)</span></code></pre></div>
<p>We can check the performance over the calibration and the validation
period.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">str</span>(OutputsCrit_Cal_NoHyst, <span class="at">max.level =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## List of 7
##  $ CritValue      : num 0.836
##  $ CritName       : chr &quot;Composite&quot;
##  $ CritBestValue  : num 1
##  $ Multiplier     : num -1
##  $ Ind_notcomputed: NULL
##  $ CritCompo      :List of 3
##   ..$ MultiCritValues : Named num [1:6] 0.937 0.147 0.48 0.65 0.707 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritNames  : Named chr [1:6] &quot;KGE2[Q]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritWeights: Named num [1:6] 0.75 0.05 0.05 0.05 0.05 0.05
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##  $ MultiCrit      :List of 6
##   ..$ IC1:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC2:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC3:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC4:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC5:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC6:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;Compo&quot; &quot;ErrorCrit&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">str</span>(OutputsCrit_Val_NoHyst, <span class="at">max.level =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## List of 7
##  $ CritValue      : num 0.773
##  $ CritName       : chr &quot;Composite&quot;
##  $ CritBestValue  : num 1
##  $ Multiplier     : num -1
##  $ Ind_notcomputed: NULL
##  $ CritCompo      :List of 3
##   ..$ MultiCritValues : Named num [1:6] 0.878 0.159 0.363 0.495 0.593 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritNames  : Named chr [1:6] &quot;KGE2[Q]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritWeights: Named num [1:6] 0.75 0.05 0.05 0.05 0.05 0.05
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##  $ MultiCrit      :List of 6
##   ..$ IC1:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC2:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC3:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC4:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC5:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC6:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;Compo&quot; &quot;ErrorCrit&quot;</code></pre>
<p>We can see above that the performance of the initial model is
slightly better than the new one over the calibration period in terms of
discharge, but also that the new version calibrated using SCA provides
better performance in terms of snow. However, over the validation
period, we see that the discharge simulated by the new version brings
better performance (in addition to improved SCA also). This shows the
interests of the combined use of a linear hysteresis and of SCA data for
calibration in CemaNeige.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent"
entry-spacing="0">
<div id="ref-riboust_revisiting_2019" class="csl-entry">
Riboust, Philippe, Guillaume Thirel, Nicolas Le Moine, and Pierre
Ribstein. 2019. <span>“Revisiting a <span>Simple</span>
<span>Degree</span>-<span>Day</span> <span>Model</span> for
<span>Integrating</span> <span>Satellite</span> <span>Data</span>:
<span>Implementation</span> of <span>Swe</span>-<span>Sca</span>
<span>Hystereses</span>.”</span> <em>Journal of Hydrology and
Hydromechanics</em> 67 (1): 70–81. <a
href="https://doi.org/10.2478/johh-2018-0004">https://doi.org/10.2478/johh-2018-0004</a>.
</div>
</div>
</div>

<footer>
  <div style="float:left"><img src="fig/logo_republique_francaise_CMJN.svg" alt="airGR logo" height=50px style="margin-top:-20px" /></div>
  <div style="float:right">Developed by INRAE&nbsp;<a href="https://webgr.inrae.fr/eng/">Catchment Hydrology Research Group</a>&nbsp;&#x2013; Antony, France</div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
